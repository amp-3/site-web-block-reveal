var b=Object.defineProperty;var w=(n,t,e)=>t in n?b(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>w(n,typeof t!="symbol"?t+"":t,e);import{B as x,C as B,a as C,T as u}from"./BaseInputHandler.js";import{G as c}from"./Graphics.js";var p=(n=>(n.SMALL="small",n.MEDIUM="medium",n.LARGE="large",n))(p||{}),f=(n=>(n[n.SMALL=9]="SMALL",n[n.MEDIUM=18]="MEDIUM",n[n.LARGE=600]="LARGE",n))(f||{});class M extends x{constructor(e){super({container:e.getApp().stage,onInput:()=>{}});r(this,"controller");r(this,"keys",new Set);r(this,"moveSpeed",1);this.controller=e}setupEventListeners(){this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}onEnable(){window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}onDisable(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp)}handleKeyDown(e){this.isEnabled&&this.keys.add(e.key)}handleKeyUp(e){this.keys.delete(e.key)}updateMovement(e){if(!this.isEnabled)return;let s=0,i=0;(this.keys.has("ArrowLeft")||this.keys.has("a")||this.keys.has("A"))&&(s-=this.moveSpeed),(this.keys.has("ArrowRight")||this.keys.has("d")||this.keys.has("D"))&&(s+=this.moveSpeed),(this.keys.has("ArrowUp")||this.keys.has("w")||this.keys.has("W"))&&(i-=this.moveSpeed),(this.keys.has("ArrowDown")||this.keys.has("s")||this.keys.has("S"))&&(i+=this.moveSpeed);const h=this.keys.has("Shift");this.controller.setPlayerSlowMode(h),(s!==0||i!==0)&&(s!==0&&i!==0&&(s*=.707,i*=.707),this.controller.movePlayer(s,i,e))}destroy(){this.disable(),this.keys.clear()}}class v{constructor(t){r(this,"sprite");r(this,"vx");r(this,"vy");r(this,"damage");r(this,"isPlayerBullet");r(this,"radius");this.vx=t.vx,this.vy=t.vy,this.damage=t.damage,this.isPlayerBullet=t.isPlayerBullet,this.radius=t.radius||4,this.sprite=new c,this.sprite.circle(0,0,this.radius).fill(t.color||16711680),this.sprite.x=t.x,this.sprite.y=t.y}update(t,e){const s=t/e;this.sprite.x+=this.vx*s,this.sprite.y+=this.vy*s}isOutOfBounds(t,e){return this.sprite.x<-50||this.sprite.x>t+50||this.sprite.y<-50||this.sprite.y>e+50}getSprite(){return this.sprite}getX(){return this.sprite.x}getY(){return this.sprite.y}getRadius(){return this.radius}getDamage(){return this.damage}getIsPlayerBullet(){return this.isPlayerBullet}}class H{constructor(t){r(this,"sprite");r(this,"shipSprite");r(this,"hitboxSprite");r(this,"hpBarContainer");r(this,"hpBarBg");r(this,"hpBarFill");r(this,"config");r(this,"slowMode",!1);r(this,"lastFireTime",0);r(this,"gameTime",0);r(this,"lives",3);r(this,"currentHp");r(this,"maxHp");r(this,"invulnerable",!1);r(this,"invulnerableTime",0);this.config=t,this.maxHp=t.maxHp,this.currentHp=this.maxHp,this.sprite=new B,this.shipSprite=new c,this.drawShip(),this.sprite.addChild(this.shipSprite),this.hitboxSprite=new c,this.drawHitbox(),this.hitboxSprite.visible=!1,this.sprite.addChild(this.hitboxSprite),this.hpBarContainer=new B,this.hpBarBg=new c,this.hpBarFill=new c,this.setupHpBar(),this.sprite.x=t.x,this.sprite.y=t.y}drawShip(){this.shipSprite.clear(),this.shipSprite.moveTo(0,-15),this.shipSprite.lineTo(-10,10),this.shipSprite.lineTo(0,5),this.shipSprite.lineTo(10,10),this.shipSprite.closePath(),this.shipSprite.fill(65280)}drawHitbox(){this.hitboxSprite.clear(),this.hitboxSprite.circle(0,0,this.config.hitboxRadius).fill({color:16711680,alpha:.5})}setupHpBar(){this.hpBarContainer.x=-50,this.hpBarContainer.y=-40,this.hpBarBg.rect(0,0,100,8).fill(3355443),this.hpBarContainer.addChild(this.hpBarBg),this.drawHpBar(),this.hpBarContainer.addChild(this.hpBarFill),this.sprite.addChild(this.hpBarContainer)}drawHpBar(){this.hpBarFill.clear();const t=this.currentHp/this.maxHp,e=100*t;let s=65280;t<=.5&&(s=16776960),t<=.25&&(s=16711680),this.hpBarFill.rect(0,0,e,8).fill(s)}update(t,e){const s=t/e;this.gameTime+=s,this.invulnerable&&(this.invulnerableTime-=s,this.invulnerableTime<=0?(this.invulnerable=!1,this.sprite.alpha=1):this.sprite.alpha=Math.sin(this.invulnerableTime*.02)>0?1:.5)}move(t,e,s,i){const h=this.slowMode?this.config.slowSpeed:this.config.speed,a=s/i;this.sprite.x+=t*h*a,this.sprite.y+=e*h*a}clampPosition(t,e,s,i){this.sprite.x=Math.max(t+20,Math.min(s-20,this.sprite.x)),this.sprite.y=Math.max(e+20,Math.min(i-20,this.sprite.y))}setSlowMode(t){this.slowMode=t,this.hitboxSprite.visible=t}shoot(){if(this.gameTime-this.lastFireTime<this.config.fireRate)return[];this.lastFireTime=this.gameTime;const t=[],e=new v({x:this.sprite.x,y:this.sprite.y-20,vx:0,vy:-.45,damage:1,isPlayerBullet:!0,color:65280,radius:1.33});return t.push(e),t}takeDamage(t=1){if(!this.invulnerable){if(this.currentHp-=t,this.drawHpBar(),this.currentHp<=0)if(this.currentHp=0,this.lives--,this.lives>0)this.currentHp=this.maxHp,this.drawHpBar();else{console.log("Game Over");return}this.invulnerable=!0,this.invulnerableTime=1e3}}reset(){this.sprite.x=this.config.x,this.sprite.y=this.config.y,this.lives=3,this.currentHp=this.maxHp,this.drawHpBar(),this.invulnerable=!1,this.invulnerableTime=0,this.sprite.alpha=1,this.slowMode=!1,this.hitboxSprite.visible=!1,this.gameTime=0,this.lastFireTime=0}getSprite(){return this.sprite}getX(){return this.sprite.x}getY(){return this.sprite.y}getHitboxRadius(){return this.config.hitboxRadius}isInvulnerable(){return this.invulnerable}getCurrentHp(){return this.currentHp}getMaxHp(){return this.maxHp}getLives(){return this.lives}}class k{constructor(t){r(this,"currentStage",1);r(this,"maxStages");r(this,"isStageActive",!0);r(this,"isBossPhase",!1);this.maxStages=t}getCurrentStage(){return this.currentStage}isActive(){return this.isStageActive}isBossActive(){return this.isBossPhase}startBossPhase(){this.isBossPhase=!0}completeBossPhase(){this.isBossPhase=!1,this.nextStage()}nextStage(){this.currentStage<this.maxStages?this.currentStage++:this.isStageActive=!1}reset(){this.currentStage=1,this.isStageActive=!0,this.isBossPhase=!1}}class A{constructor(t,e,s){r(this,"sprite");r(this,"config");r(this,"hp");r(this,"maxHp");r(this,"time",0);r(this,"lastFireTime",0);r(this,"startX");r(this,"startY");r(this,"shouldFireNow",!1);this.config=t,this.hp=t.hp,this.maxHp=t.hp,this.startX=e,this.startY=s,this.sprite=new c,this.drawEnemy(),this.sprite.x=e,this.sprite.y=s}drawEnemy(){this.sprite.clear();const t=this.getColorByType(),e=this.getSizeByType();this.sprite.circle(0,0,e).fill(t),this.hp<this.maxHp&&(this.sprite.lineStyle(2,16777215),this.sprite.arc(0,0,e+5,-Math.PI/2,-Math.PI/2+Math.PI*2*this.hp/this.maxHp))}getColorByType(){switch(this.config.type){case"small":return 16737894;case"medium":return 16724787;case"large":return 16711680;default:return 16711680}}getSizeByType(){switch(this.config.type){case"small":return 20;case"medium":return 30;case"large":return 40;default:return 20}}update(t,e){const s=t/e;this.time+=s,this.updateMovement(s),this.shouldFireNow=this.updateFiring()}updateMovement(t){const e=this.config.movement,s=this.time*.001;switch(e.type){case"linear":this.sprite.y+=e.speed*t;break;case"sine":this.sprite.x=this.startX+Math.sin(s*(e.frequency||1))*(e.amplitude||50),this.sprite.y+=e.speed*t;break;case"circular":const i=s*(e.frequency||1);this.sprite.x=this.startX+Math.cos(i)*(e.amplitude||50),this.sprite.y=this.startY+Math.sin(i)*(e.amplitude||50)+s*e.speed;break;case"custom":if(e.customFunction){const h=e.customFunction(s);this.sprite.x=this.startX+h.x,this.sprite.y=this.startY+h.y}break}}updateFiring(){if(!this.config.firePattern)return!1;const t=this.config.firePattern;return this.time-this.lastFireTime>=t.interval?(this.lastFireTime=this.time,!0):!1}shouldFire(){return this.shouldFireNow}createBullets(t){const e=[];switch(t.type){case"single":e.push(new v({x:this.sprite.x,y:this.sprite.y,vx:0,vy:t.bulletSpeed,damage:1,isPlayerBullet:!1}));break;case"spread":const s=t.bulletCount||3,i=t.spreadAngle||30;for(let a=0;a<s;a++){const l=i*(a-(s-1)/2)*Math.PI/180;e.push(new v({x:this.sprite.x,y:this.sprite.y,vx:Math.sin(l)*t.bulletSpeed,vy:Math.cos(l)*t.bulletSpeed,damage:1,isPlayerBullet:!1}))}break;case"circular":const h=t.bulletCount||8;for(let a=0;a<h;a++){const l=360/h*a*Math.PI/180;e.push(new v({x:this.sprite.x,y:this.sprite.y,vx:Math.cos(l)*t.bulletSpeed,vy:Math.sin(l)*t.bulletSpeed,damage:1,isPlayerBullet:!1}))}break}return e}takeDamage(t){this.hp-=t,this.drawEnemy()}isAlive(){return this.hp>0}isOutOfBounds(t,e){return this.sprite.x<-100||this.sprite.x>t+100||this.sprite.y>e+100}getSprite(){return this.sprite}getX(){return this.sprite.x}getY(){return this.sprite.y}getRadius(){return this.getSizeByType()}getScore(){return this.config.score}getFirePattern(){return this.config.firePattern}}class E{constructor(t,e){r(this,"spawnTimer",0);r(this,"spawnInterval",2e3);r(this,"gameWidth");this.gameWidth=t}update(t,e,s){const i=t/s;this.spawnTimer+=i;const h=[];if(this.spawnTimer>=this.spawnInterval){this.spawnTimer=0;const a=Math.min(e,3);for(let l=0;l<a;l++)h.push(this.createEnemy(e));this.spawnInterval=Math.max(1e3,2e3-e*100)}return h}createEnemy(t){const e=Math.random()*(this.gameWidth-100)+50,s=-50,h=[p.SMALL,p.MEDIUM,p.LARGE][Math.min(Math.floor(Math.random()*t),2)];let a,l;switch(h){case p.SMALL:a=3,l=100;break;case p.MEDIUM:a=3,l=300;break;case p.LARGE:a=3,l=500;break}const o=Math.random()>.5?"sine":"linear";return new A({type:h,hp:a,score:l,movement:{type:o,speed:.05+Math.random()*.03,amplitude:o==="sine"?50+Math.random()*50:void 0,frequency:o==="sine"?1+Math.random():void 0},firePattern:{type:"single",interval:800,bulletSpeed:.2}},e,s)}reset(){this.spawnTimer=0,this.spawnInterval=2e3}}class P{constructor(t,e,s,i,h,a){r(this,"player");r(this,"getEnemies");r(this,"getEnemyBullets");r(this,"getPlayerBullets");this.player=t,this.getEnemies=e,this.getEnemyBullets=s,this.getPlayerBullets=i}check(){const t={playerHit:!1,destroyedEnemies:[],hitBullets:[],hitPlayerBullets:[]},e=this.getEnemies(),s=this.getEnemyBullets(),i=this.getPlayerBullets();if(!this.player.isInvulnerable())for(const h of s)this.checkCircleCollision(this.player.getX(),this.player.getY(),this.player.getHitboxRadius(),h.getX(),h.getY(),h.getRadius())&&(t.playerHit=!0,t.hitBullets.push(h));for(const h of i)for(const a of e)if(a.isAlive()&&this.checkCircleCollision(h.getX(),h.getY(),h.getRadius(),a.getX(),a.getY(),a.getRadius())){a.takeDamage(h.getDamage()),t.hitPlayerBullets.push(h),a.isAlive()||t.destroyedEnemies.push(a);break}return t}checkCircleCollision(t,e,s,i,h,a){const l=i-t,o=h-e;return Math.sqrt(l*l+o*o)<s+a}}class T{constructor(){r(this,"score",0);r(this,"highScore",0);r(this,"combo",0);r(this,"maxCombo",0);const t=localStorage.getItem("shootingHighScore");t&&(this.highScore=parseInt(t,10))}addScore(t){this.score+=t*(1+this.combo*.1),this.combo++,this.maxCombo=Math.max(this.maxCombo,this.combo),this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("shootingHighScore",this.highScore.toString()))}resetCombo(){this.combo=0}getScore(){return Math.floor(this.score)}getHighScore(){return Math.floor(this.highScore)}getCombo(){return this.combo}reset(){this.score=0,this.combo=0,this.maxCombo=0}}class I{constructor(){r(this,"grazeRadius",30);r(this,"grazedBullets",new Set)}checkGraze(t,e){let s=0;const i=[];for(const a of e)if(!a.getIsPlayerBullet()&&!this.grazedBullets.has(a)){const l=this.getDistance(t.getX(),t.getY(),a.getX(),a.getY());l<this.grazeRadius&&l>t.getHitboxRadius()+a.getRadius()&&(this.grazedBullets.add(a),s++,i.push({bullet:a,x:a.getX(),y:a.getY()}))}const h=new Set(e);for(const a of this.grazedBullets)h.has(a)||this.grazedBullets.delete(a);return{count:s,events:i}}createGrazeEffect(t,e,s){for(let h=0;h<8;h++){const a=new c;a.circle(0,0,2).fill(16776960);const l=h/8*Math.PI*2,o=50+Math.random()*30,m=Math.cos(l)*o,d=Math.sin(l)*o;a.x=e,a.y=s,t.addChild(a);let y=.5;const S=()=>{if(y-=1/60,y<=0){t.removeChild(a);return}a.x+=m*(1/60),a.y+=d*(1/60),a.alpha=y/.5,requestAnimationFrame(S)};requestAnimationFrame(S)}}getDistance(t,e,s,i){const h=s-t,a=i-e;return Math.sqrt(h*h+a*a)}reset(){this.grazedBullets.clear()}}class F extends C{constructor(e){super(e);r(this,"gameContainer");r(this,"inputHandler");r(this,"player");r(this,"enemies",[]);r(this,"boss",null);r(this,"bullets",[]);r(this,"playerBullets",[]);r(this,"stageSystem");r(this,"enemySpawner");r(this,"collisionSystem");r(this,"scoreSystem");r(this,"grazeSystem");r(this,"gameAreaWidth");r(this,"gameAreaHeight");r(this,"lastScoreThreshold",0);this.gameAreaWidth=e.gameAreaWidth||480,this.gameAreaHeight=e.gameAreaHeight||640}setupGameSpecific(){this.setupGameArea(),this.initPlayer(),this.initSystems(),this.setupInputHandler(),this.app.ticker.add(e=>this.update(e.deltaTime),this)}setupGameArea(){this.gameContainer=new B,this.app.stage.addChild(this.gameContainer);const e=new c;e.rect(0,0,this.gameAreaWidth,this.gameAreaHeight).fill(4386),this.gameContainer.addChild(e);const s=new c;s.rect(0,0,this.gameAreaWidth,this.gameAreaHeight).fill(16777215),this.gameContainer.mask=s,this.gameContainer.addChild(s)}initPlayer(){this.player=new H({x:this.gameAreaWidth/2,y:this.gameAreaHeight-100,speed:.35,slowSpeed:.15,hitboxRadius:4,fireRate:250,maxHp:5}),this.gameContainer.addChild(this.player.getSprite())}initSystems(){this.scoreSystem=new T;const e=this.options;this.stageSystem=new k(e.stageCount||3),this.enemySpawner=new E(this.gameAreaWidth,this.gameAreaHeight),this.collisionSystem=new P(this.player,()=>this.enemies,()=>this.bullets,()=>this.playerBullets,this.gameAreaWidth,this.gameAreaHeight),this.grazeSystem=new I}setupInputHandler(){this.inputHandler=new M(this)}update(e){this.updateScroll(e),this.updateEntities(e),this.inputHandler.updateMovement(e),this.spawnEnemies(e),this.checkCollisions(),this.checkScoreThreshold(),this.cleanupEntities()}updateScroll(e){}updateEntities(e){this.player.update(e,u.targetFPMS),this.player.shoot().forEach(i=>{this.playerBullets.push(i),this.gameContainer.addChild(i.getSprite())}),this.enemies.forEach(i=>{i.update(e,u.targetFPMS),i.shouldFire()&&i.getFirePattern()&&i.createBullets(i.getFirePattern()).forEach(a=>{this.bullets.push(a),this.gameContainer.addChild(a.getSprite())})}),this.boss&&this.boss.update(e),this.bullets.forEach(i=>i.update(e,u.targetFPMS)),this.playerBullets.forEach(i=>i.update(e,u.targetFPMS))}spawnEnemies(e){!this.boss&&this.stageSystem.isActive()&&this.enemySpawner.update(e,this.stageSystem.getCurrentStage(),u.targetFPMS).forEach(i=>{this.enemies.push(i),this.gameContainer.addChild(i.getSprite())})}checkCollisions(){const e=this.collisionSystem.check();e.playerHit&&this.player.takeDamage(),e.destroyedEnemies.forEach(i=>{this.scoreSystem.addScore(i.getScore()),this.triggerBlockReveal(i.getX(),i.getY(),f.SMALL)}),e.hitBullets.forEach(i=>{this.gameContainer.removeChild(i.getSprite())}),this.bullets=this.bullets.filter(i=>!e.hitBullets.includes(i)),e.hitPlayerBullets.forEach(i=>{this.gameContainer.removeChild(i.getSprite())}),this.playerBullets=this.playerBullets.filter(i=>!e.hitPlayerBullets.includes(i));const s=this.grazeSystem.checkGraze(this.player,this.bullets);s.count>0&&(this.scoreSystem.addScore(s.count*10),this.triggerBlockReveal(this.player.getX(),this.player.getY(),f.SMALL),s.events.forEach(i=>{this.grazeSystem.createGrazeEffect(this.gameContainer,i.x,i.y)}))}checkScoreThreshold(){const e=this.scoreSystem.getScore(),s=Math.floor(e/1e4)*1e4;s>this.lastScoreThreshold&&s>0&&(this.lastScoreThreshold=s,this.triggerBlockReveal(this.gameAreaWidth/2,this.gameAreaHeight/2,f.MEDIUM))}cleanupEntities(){this.enemies=this.enemies.filter(e=>!e.isAlive()||e.isOutOfBounds(this.gameAreaWidth,this.gameAreaHeight)?(this.gameContainer.removeChild(e.getSprite()),!1):!0),this.bullets=this.bullets.filter(e=>e.isOutOfBounds(this.gameAreaWidth,this.gameAreaHeight)?(this.gameContainer.removeChild(e.getSprite()),!1):!0),this.playerBullets=this.playerBullets.filter(e=>e.isOutOfBounds(this.gameAreaWidth,this.gameAreaHeight)?(this.gameContainer.removeChild(e.getSprite()),!1):!0)}triggerBlockReveal(e,s,i){const h=Math.random(),a=Math.random();this.blockReveal.reveal({x:h,y:a,radius:i,force:i*.1,duration:1e3})}movePlayer(e,s,i){this.player.move(e,s,i,u.targetFPMS),this.player.clampPosition(0,0,this.gameAreaWidth,this.gameAreaHeight)}setPlayerSlowMode(e){this.player.setSlowMode(e)}playerShoot(){this.player.shoot().forEach(s=>{this.playerBullets.push(s),this.gameContainer.addChild(s.getSprite())})}onImagesLoaded(){console.log("Shooting game images loaded"),this.inputHandler&&this.inputHandler.enable()}setupAdditionalEventListeners(){}handleGameSpecificKeyDown(e){this.inputHandler.handleKeyDown(e)}onReset(){this.enemies.forEach(e=>this.gameContainer.removeChild(e.getSprite())),this.bullets.forEach(e=>this.gameContainer.removeChild(e.getSprite())),this.playerBullets.forEach(e=>this.gameContainer.removeChild(e.getSprite())),this.enemies=[],this.bullets=[],this.playerBullets=[],this.boss=null,this.player.reset(),this.scoreSystem.reset(),this.stageSystem.reset(),this.lastScoreThreshold=0}destroyGameSpecific(){this.app.ticker.remove(e=>this.update(e.deltaTime),this),this.inputHandler.destroy()}resize(){super.resize();const e=this.containerElement,s=e.clientWidth,i=e.clientHeight,a=s*1,l=i,o=a/this.gameAreaWidth,m=l/this.gameAreaHeight,d=Math.min(o,m);this.gameContainer.scale.set(d);const y=this.gameAreaWidth*d,S=this.gameAreaHeight*d;this.gameContainer.x=(s-y)/2,this.gameContainer.y=(i-S)/2}}let g;async function L(){g=new F({containerId:"shooting-game-area",blockRevealContainerId:"block-reveal-area",backgroundImage:"./assets/images/background.png",foregroundImage:"./assets/images/foreground.png",blockSize:8,gravity:1e3,explosionForce:300,fadeOutDuration:500,stageCount:3,playerLives:3,continueCount:3});const n=()=>{var i,h,a;const t=((i=g.scoreSystem)==null?void 0:i.getScore())||0,e=((h=g.scoreSystem)==null?void 0:h.getHighScore())||0,s=((a=g.stageSystem)==null?void 0:a.getCurrentStage())||1;document.getElementById("score").textContent=t.toString(),document.getElementById("high-score").textContent=e.toString(),document.getElementById("stage").textContent=s.toString(),requestAnimationFrame(n)};n()}document.getElementById("reset-button").addEventListener("click",()=>{g&&g.reset()});window.addEventListener("load",L);
