var b=Object.defineProperty;var H=(h,t,e)=>t in h?b(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var a=(h,t,e)=>H(h,typeof t!="symbol"?t+"":t,e);import{C as y,B as O,c as C,S as _,a as N,A as P,T as S}from"./BaseInputHandler.js";import{G as A}from"./Graphics.js";var p=(h=>(h.SMALL="small",h.MEDIUM="medium",h.LARGE="large",h))(p||{}),g=(h=>(h.TYPE1="type1",h.TYPE2="type2",h))(g||{}),M=(h=>(h[h.SMALL=9]="SMALL",h[h.MEDIUM=18]="MEDIUM",h[h.LARGE=600]="LARGE",h))(M||{});class s{}a(s,"GAME",{AREA_WIDTH:480,AREA_HEIGHT:640,BACKGROUND_COLOR:4386,AREA_RATIO:1}),a(s,"BACKGROUND",{IMAGE_PATH:"./assets/images/shooting/bg_1.png",SCROLL_SPEED:.1}),a(s,"PLAYER",{DEFAULT_Y_OFFSET:100,MOVEMENT_MARGIN:20,HITBOX_RADIUS:4,SPEED:.35,SLOW_SPEED:.15,DIAGONAL_MULTIPLIER:.707,FIRE_RATE:250,MAX_HP:5,DEFAULT_LIVES:3,INVULNERABILITY_DURATION:1e3,INVULNERABILITY_BLINK_RATE:.02,SHIP_COORDS:{TOP_X:0,TOP_Y:-15,LEFT_X:-10,LEFT_Y:10,BOTTOM_CENTER_X:0,BOTTOM_CENTER_Y:5,RIGHT_X:10,RIGHT_Y:10},HP_BAR:{WIDTH:100,HEIGHT:8,OFFSET_X:-50,OFFSET_Y:-40,COLORS:{HIGH:65280,MEDIUM:16776960,LOW:16711680}},BULLET:{OFFSET_Y:-20,VELOCITY_X:0,VELOCITY_Y:-.45,DAMAGE:1,COLOR:65280,RADIUS:1.33}}),a(s,"ENEMY",{IMAGES:{TYPE1:{PATH:"./assets/images/shooting/enemy_1.png",ORIGINAL_WIDTH:96,ORIGINAL_HEIGHT:128},TYPE2:{PATH:"./assets/images/shooting/enemy_2.png",ORIGINAL_WIDTH:128,ORIGINAL_HEIGHT:96}},TYPES:{SMALL:{WIDTH:28,HEIGHT:38,HP:3,SCORE:100},MEDIUM:{WIDTH:42,HEIGHT:56,HP:3,SCORE:300},LARGE:{WIDTH:56,HEIGHT:74,HP:3,SCORE:500}},TYPE2_SIZES:{SMALL:{WIDTH:38,HEIGHT:28,HP:2,SCORE:150},MEDIUM:{WIDTH:56,HEIGHT:42,HP:5,SCORE:400},LARGE:{WIDTH:74,HEIGHT:56,HP:8,SCORE:600}},COLORS:{SMALL:16737894,MEDIUM:16724787,LARGE:16711680},HEALTH_BAR:{STROKE_WIDTH:2,COLOR:16777215,RADIUS_OFFSET:5},MOVEMENT:{TIME_MULTIPLIER:.001,DEFAULT_AMPLITUDE:50,SPEED_MIN:.05,SPEED_RANDOM:.03,SINE_AMPLITUDE_MIN:50,SINE_AMPLITUDE_RANDOM:50,SINE_FREQUENCY_MIN:1,SINE_FREQUENCY_RANDOM:1},FIRING:{INTERVAL:800,BULLET_SPEED:.2,BULLET_DAMAGE:1,SPREAD_ANGLE:30,SPREAD_COUNT:3,CIRCULAR_COUNT:8},BOUNDS_MARGIN:100}),a(s,"SPAWNING",{DEFAULT_INTERVAL:2e3,INTERVAL_REDUCTION_PER_STAGE:100,MIN_INTERVAL:1e3,MAX_COUNT_PER_WAVE:3,SPAWN_Y_OFFSET:-50,SPAWN_MARGIN:50}),a(s,"BOSS",{VISUAL_SIZE:{WIDTH:80,HEIGHT:60},COLOR:16711935,POSITION_OFFSET:{X:-40,Y:-30}}),a(s,"BULLET",{DEFAULT_RADIUS:4,DEFAULT_COLOR:16711680,BOUNDS_MARGIN:50}),a(s,"GRAZE",{RADIUS:30,SCORE_PER_BULLET:10,PARTICLE:{COUNT:8,RADIUS:2,COLOR:16776960,SPEED_MIN:50,SPEED_MAX:80,LIFETIME:.5,TARGET_FPS:60}}),a(s,"SCORE",{COMBO_MULTIPLIER:.1,BLOCK_REVEAL_THRESHOLD:1e4}),a(s,"STAGE",{DEFAULT_MAX_STAGES:3,STARTING_STAGE:1}),a(s,"INPUT",{MOVE_SPEED:1,SHOOT_COOLDOWN:100,DEFAULT_OPTIONS:{ENABLE_KEYBOARD:!0,ENABLE_MOUSE:!1,ENABLE_TOUCH:!1,ENABLE_GAMEPAD:!0,AUTO_FIRE:!0,MOUSE_CONTROL_TYPE:"relative",TOUCH_CONTROL_TYPE:"follow"},GAMEPAD:{DEADZONE:.15},MOUSE:{FOLLOW_SPEED:.1},TOUCH:{VIRTUAL_STICK_RADIUS:80,VISUAL:{BASE_COLOR:16777215,BASE_ALPHA:.3,KNOB_COLOR:16777215,KNOB_ALPHA:.6,KNOB_RADIUS:25}}}),a(s,"BLOCK_REVEAL",{FORCE_MULTIPLIER:.1,DURATION:1e3}),a(s,"DIFFICULTY",{EASY:{PLAYER_SPEED_MULTIPLIER:1.2,ENEMY_SPEED_MULTIPLIER:.8,SPAWN_INTERVAL_MULTIPLIER:1.5},NORMAL:{PLAYER_SPEED_MULTIPLIER:1,ENEMY_SPEED_MULTIPLIER:1,SPAWN_INTERVAL_MULTIPLIER:1},HARD:{PLAYER_SPEED_MULTIPLIER:.9,ENEMY_SPEED_MULTIPLIER:1.3,SPAWN_INTERVAL_MULTIPLIER:.7}});class D{constructor(){a(this,"keys",new Set);a(this,"enabled",!1);a(this,"handleKeyDown",t=>{this.enabled&&this.keys.add(t.key)});a(this,"handleKeyUp",t=>{this.keys.delete(t.key)})}enable(){this.enabled=!0,window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}disable(){this.enabled=!1,window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),this.keys.clear()}getInputState(){let t=0,e=0;if((this.keys.has("ArrowLeft")||this.keys.has("a")||this.keys.has("A"))&&(t-=1),(this.keys.has("ArrowRight")||this.keys.has("d")||this.keys.has("D"))&&(t+=1),(this.keys.has("ArrowUp")||this.keys.has("w")||this.keys.has("W"))&&(e-=1),(this.keys.has("ArrowDown")||this.keys.has("s")||this.keys.has("S"))&&(e+=1),t!==0&&e!==0){const i=Math.sqrt(t*t+e*e);t/=i,e/=i}return{movement:{x:t,y:e},shooting:this.keys.has(" ")||this.keys.has("Space"),slowMode:this.keys.has("Shift"),pause:this.keys.has("Escape")}}update(t){}destroy(){this.disable()}}class B{constructor(t,e="relative"){a(this,"enabled",!1);a(this,"mousePosition",{x:0,y:0});a(this,"leftButtonDown",!1);a(this,"rightButtonDown",!1);a(this,"container");a(this,"controlType");a(this,"handleMouseMove",t=>{if(!this.enabled)return;const e=this.container.getBoundingClientRect();this.mousePosition={x:(t.clientX-e.left)/e.width,y:(t.clientY-e.top)/e.height}});a(this,"handleMouseDown",t=>{this.enabled&&(t.button===0&&(this.leftButtonDown=!0),t.button===2&&(this.rightButtonDown=!0))});a(this,"handleMouseUp",t=>{t.button===0&&(this.leftButtonDown=!1),t.button===2&&(this.rightButtonDown=!1)});a(this,"handleContextMenu",t=>{t.preventDefault()});this.container=t,this.controlType=e}enable(){this.enabled=!0,this.container.addEventListener("mousemove",this.handleMouseMove),this.container.addEventListener("mousedown",this.handleMouseDown),this.container.addEventListener("mouseup",this.handleMouseUp),this.container.addEventListener("contextmenu",this.handleContextMenu),document.addEventListener("mouseup",this.handleMouseUp)}disable(){this.enabled=!1,this.container.removeEventListener("mousemove",this.handleMouseMove),this.container.removeEventListener("mousedown",this.handleMouseDown),this.container.removeEventListener("mouseup",this.handleMouseUp),this.container.removeEventListener("contextmenu",this.handleContextMenu),document.removeEventListener("mouseup",this.handleMouseUp),this.leftButtonDown=!1,this.rightButtonDown=!1}getInputState(){const t={movement:{x:0,y:0},shooting:this.leftButtonDown,slowMode:this.rightButtonDown};if(this.controlType==="absolute")t.position={...this.mousePosition};else{t.movement={x:(this.mousePosition.x-.5)*2,y:(this.mousePosition.y-.5)*2};const e=Math.sqrt(t.movement.x**2+t.movement.y**2);e>1&&(t.movement.x/=e,t.movement.y/=e)}return t}update(t){}destroy(){this.disable()}}class v{constructor(t,e="follow",i){a(this,"enabled",!1);a(this,"container");a(this,"controlType");a(this,"pixiContainer");a(this,"touchId",null);a(this,"touchPosition",{x:.5,y:.5});a(this,"isTouching",!1);a(this,"isMultiTouch",!1);a(this,"stickOrigin",null);a(this,"stickRadius",s.INPUT.TOUCH.VIRTUAL_STICK_RADIUS);a(this,"stickVisualContainer");a(this,"stickBase");a(this,"stickKnob");a(this,"handleTouchStart",t=>{if(this.enabled){if(t.preventDefault(),t.touches.length>0&&this.touchId===null){const e=t.touches[0];this.touchId=e.identifier;const i=this.container.getBoundingClientRect();this.touchPosition={x:(e.clientX-i.left)/i.width,y:(e.clientY-i.top)/i.height},this.controlType==="virtual-stick"&&(this.stickOrigin={x:e.clientX-i.left,y:e.clientY-i.top},this.showVirtualStick(this.stickOrigin.x,this.stickOrigin.y)),this.isTouching=!0}t.touches.length>=2&&(this.isMultiTouch=!0)}});a(this,"handleTouchMove",t=>{if(!(!this.enabled||this.touchId===null)){t.preventDefault();for(let e=0;e<t.touches.length;e++){const i=t.touches[e];if(i.identifier===this.touchId){const n=this.container.getBoundingClientRect();if(this.controlType==="follow")this.touchPosition={x:(i.clientX-n.left)/n.width,y:(i.clientY-n.top)/n.height};else if(this.controlType==="virtual-stick"&&this.stickOrigin){const o=i.clientX-n.left,r=i.clientY-n.top,l=o-this.stickOrigin.x,c=r-this.stickOrigin.y,d=Math.sqrt(l*l+c*c),u=Math.min(d,this.stickRadius);d>0&&(this.touchPosition={x:.5+l/d*(u/this.stickRadius)*.5,y:.5+c/d*(u/this.stickRadius)*.5},this.updateVirtualStickKnob(l/d*u,c/d*u))}break}}}});a(this,"handleTouchEnd",t=>{if(!this.enabled)return;t.preventDefault();let e=!1;for(let i=0;i<t.touches.length;i++)if(t.touches[i].identifier===this.touchId){e=!0;break}e||(this.touchId=null,this.isTouching=!1,this.stickOrigin=null,this.touchPosition={x:.5,y:.5},this.hideVirtualStick()),t.touches.length<2&&(this.isMultiTouch=!1)});this.container=t,this.controlType=e,this.pixiContainer=i,this.controlType==="virtual-stick"&&i&&this.createVirtualStickVisual()}enable(){this.enabled=!0,this.container.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.container.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.container.addEventListener("touchend",this.handleTouchEnd,{passive:!1}),this.container.addEventListener("touchcancel",this.handleTouchEnd,{passive:!1})}disable(){this.enabled=!1,this.container.removeEventListener("touchstart",this.handleTouchStart),this.container.removeEventListener("touchmove",this.handleTouchMove),this.container.removeEventListener("touchend",this.handleTouchEnd),this.container.removeEventListener("touchcancel",this.handleTouchEnd),this.reset()}reset(){this.touchId=null,this.isTouching=!1,this.isMultiTouch=!1,this.stickOrigin=null,this.touchPosition={x:.5,y:.5}}getInputState(){const t={movement:{x:0,y:0},shooting:this.isTouching&&!this.isMultiTouch,slowMode:this.isMultiTouch};return this.controlType==="follow"&&this.isTouching?t.position={...this.touchPosition}:this.controlType==="virtual-stick"&&this.isTouching&&(t.movement={x:(this.touchPosition.x-.5)*2,y:(this.touchPosition.y-.5)*2}),t}update(t){}destroy(){this.disable(),this.stickVisualContainer&&this.pixiContainer&&(this.pixiContainer.removeChild(this.stickVisualContainer),this.stickVisualContainer.destroy({children:!0}))}createVirtualStickVisual(){this.pixiContainer&&(this.stickVisualContainer=new y,this.stickVisualContainer.visible=!1,this.stickBase=new A,this.stickBase.lineStyle(3,s.INPUT.TOUCH.VISUAL.BASE_COLOR,s.INPUT.TOUCH.VISUAL.BASE_ALPHA),this.stickBase.drawCircle(0,0,this.stickRadius),this.stickBase.endFill(),this.stickKnob=new A,this.stickKnob.beginFill(s.INPUT.TOUCH.VISUAL.KNOB_COLOR,s.INPUT.TOUCH.VISUAL.KNOB_ALPHA),this.stickKnob.drawCircle(0,0,s.INPUT.TOUCH.VISUAL.KNOB_RADIUS),this.stickKnob.endFill(),this.stickVisualContainer.addChild(this.stickBase),this.stickVisualContainer.addChild(this.stickKnob),this.pixiContainer.addChild(this.stickVisualContainer))}showVirtualStick(t,e){this.stickVisualContainer&&(this.stickVisualContainer.position.set(t,e),this.stickVisualContainer.visible=!0,this.stickKnob&&this.stickKnob.position.set(0,0))}hideVirtualStick(){this.stickVisualContainer&&(this.stickVisualContainer.visible=!1)}updateVirtualStickKnob(t,e){this.stickKnob&&this.stickKnob.position.set(t,e)}}class w{constructor(t=s.INPUT.GAMEPAD.DEADZONE){a(this,"enabled",!1);a(this,"deadzone",s.INPUT.GAMEPAD.DEADZONE);a(this,"gamepadIndex",null);a(this,"handleGamepadConnected",t=>{this.gamepadIndex===null&&(this.gamepadIndex=t.gamepad.index,console.log(`Gamepad connected: ${t.gamepad.id}`))});a(this,"handleGamepadDisconnected",t=>{this.gamepadIndex===t.gamepad.index&&(this.gamepadIndex=null,console.log(`Gamepad disconnected: ${t.gamepad.id}`))});this.deadzone=t}enable(){this.enabled=!0,window.addEventListener("gamepadconnected",this.handleGamepadConnected),window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnected);const t=navigator.getGamepads();for(let e=0;e<t.length;e++){const i=t[e];if(i){this.gamepadIndex=e,console.log(`Gamepad already connected: ${i.id}`);break}}}disable(){this.enabled=!1,window.removeEventListener("gamepadconnected",this.handleGamepadConnected),window.removeEventListener("gamepaddisconnected",this.handleGamepadDisconnected),this.gamepadIndex=null}applyDeadzone(t){return Math.abs(t)>this.deadzone?t:0}getInputState(){var l,c,d,u,E,m,I,L;const t={movement:{x:0,y:0},shooting:!1,slowMode:!1,pause:!1};if(!this.enabled||this.gamepadIndex===null)return t;const i=navigator.getGamepads()[this.gamepadIndex];if(!i)return t;let n=this.applyDeadzone(i.axes[0]),o=this.applyDeadzone(i.axes[1]);(l=i.buttons[14])!=null&&l.pressed&&(n-=1),(c=i.buttons[15])!=null&&c.pressed&&(n+=1),(d=i.buttons[12])!=null&&d.pressed&&(o-=1),(u=i.buttons[13])!=null&&u.pressed&&(o+=1);const r=Math.sqrt(n*n+o*o);return r>1&&(n/=r,o/=r),t.movement={x:n,y:o},t.shooting=((E=i.buttons[0])==null?void 0:E.pressed)||!1,t.slowMode=((m=i.buttons[6])==null?void 0:m.pressed)||((I=i.buttons[7])==null?void 0:I.pressed)||!1,t.pause=((L=i.buttons[9])==null?void 0:L.pressed)||!1,t}update(t){}destroy(){this.disable()}}class Y extends O{constructor(e,i){super({container:{eventMode:"none"},onInput:()=>{}});a(this,"controller");a(this,"moveSpeed",s.INPUT.MOVE_SPEED);a(this,"inputHandlers",[]);a(this,"keyboardHandler");a(this,"mouseHandler");a(this,"touchHandler");a(this,"gamepadHandler");a(this,"options");a(this,"autoFire");a(this,"lastShootTime",0);a(this,"shootCooldown",s.INPUT.SHOOT_COOLDOWN);this.controller=e,this.options={enableKeyboard:!0,enableMouse:!1,enableTouch:!1,enableGamepad:!0,autoFire:!0,mouseControlType:"relative",touchControlType:"follow",...i},this.autoFire=this.options.autoFire??!0,this.initializeInputHandlers()}initializeInputHandlers(){const e=this.controller.getCanvas(),i=this.controller.getGameContainer();this.options.enableKeyboard&&(this.keyboardHandler=new D,this.inputHandlers.push(this.keyboardHandler)),this.options.enableMouse&&(this.mouseHandler=new B(e,this.options.mouseControlType),this.inputHandlers.push(this.mouseHandler)),this.options.enableTouch&&(this.touchHandler=new v(e,this.options.touchControlType,i),this.inputHandlers.push(this.touchHandler)),this.options.enableGamepad&&(this.gamepadHandler=new w,this.inputHandlers.push(this.gamepadHandler))}setupEventListeners(){}onEnable(){this.inputHandlers.forEach(e=>e.enable())}onDisable(){this.inputHandlers.forEach(e=>e.disable())}handleKeyDown(e){this.isEnabled}getCombinedInputState(){const e={movement:{x:0,y:0},shooting:!1,slowMode:!1,pause:!1};for(const i of this.inputHandlers){const n=i.getInputState();Math.abs(n.movement.x)>Math.abs(e.movement.x)&&(e.movement.x=n.movement.x),Math.abs(n.movement.y)>Math.abs(e.movement.y)&&(e.movement.y=n.movement.y),n.position&&(e.position=n.position),e.shooting=e.shooting||n.shooting,e.slowMode=e.slowMode||n.slowMode,n.pause!==void 0&&(e.pause=e.pause||n.pause)}return e}updateMovement(e){if(!this.isEnabled)return;const i=this.getCombinedInputState(),n=Date.now();if(this.controller.setPlayerSlowMode(i.slowMode),i.position)this.controller.movePlayerToPosition(i.position.x,i.position.y,e);else if(i.movement.x!==0||i.movement.y!==0){let o=i.movement.x*this.moveSpeed,r=i.movement.y*this.moveSpeed;this.controller.movePlayer(o,r,e)}(this.autoFire||i.shooting)&&!this.autoFire&&n-this.lastShootTime>=this.shootCooldown&&(this.controller.playerShoot(),this.lastShootTime=n),i.pause}setAutoFire(e){this.autoFire=e}isAutoFireEnabled(){return this.autoFire}destroy(){this.disable(),this.inputHandlers.forEach(e=>e.destroy()),this.inputHandlers=[]}}class R{constructor(t){a(this,"sprite");a(this,"vx");a(this,"vy");a(this,"damage");a(this,"isPlayerBullet");a(this,"radius");this.vx=t.vx,this.vy=t.vy,this.damage=t.damage,this.isPlayerBullet=t.isPlayerBullet,this.radius=t.radius||s.BULLET.DEFAULT_RADIUS,this.sprite=new A,this.sprite.circle(0,0,this.radius).fill(t.color||s.BULLET.DEFAULT_COLOR),this.sprite.x=t.x,this.sprite.y=t.y}update(t,e){const i=t/e;this.sprite.x+=this.vx*i,this.sprite.y+=this.vy*i}isOutOfBounds(t,e){const i=s.BULLET.BOUNDS_MARGIN;return this.sprite.x<-i||this.sprite.x>t+i||this.sprite.y<-i||this.sprite.y>e+i}getSprite(){return this.sprite}getX(){return this.sprite.x}getY(){return this.sprite.y}getRadius(){return this.radius}getDamage(){return this.damage}getIsPlayerBullet(){return this.isPlayerBullet}}class U{constructor(t){a(this,"sprite");a(this,"shipSprite");a(this,"hitboxSprite");a(this,"hpBarContainer");a(this,"hpBarBg");a(this,"hpBarFill");a(this,"config");a(this,"slowMode",!1);a(this,"lastFireTime",0);a(this,"gameTime",0);a(this,"lives",s.PLAYER.DEFAULT_LIVES);a(this,"currentHp");a(this,"maxHp");a(this,"invulnerable",!1);a(this,"invulnerableTime",0);this.config=t,this.maxHp=t.maxHp,this.currentHp=this.maxHp,this.sprite=new y,this.shipSprite=new A,this.drawShip(),this.sprite.addChild(this.shipSprite),this.hitboxSprite=new A,this.drawHitbox(),this.hitboxSprite.visible=!1,this.sprite.addChild(this.hitboxSprite),this.hpBarContainer=new y,this.hpBarBg=new A,this.hpBarFill=new A,this.setupHpBar(),this.sprite.x=t.x,this.sprite.y=t.y}drawShip(){this.shipSprite.clear(),this.shipSprite.moveTo(s.PLAYER.SHIP_COORDS.TOP_X,s.PLAYER.SHIP_COORDS.TOP_Y),this.shipSprite.lineTo(s.PLAYER.SHIP_COORDS.LEFT_X,s.PLAYER.SHIP_COORDS.LEFT_Y),this.shipSprite.lineTo(s.PLAYER.SHIP_COORDS.BOTTOM_CENTER_X,s.PLAYER.SHIP_COORDS.BOTTOM_CENTER_Y),this.shipSprite.lineTo(s.PLAYER.SHIP_COORDS.RIGHT_X,s.PLAYER.SHIP_COORDS.RIGHT_Y),this.shipSprite.closePath(),this.shipSprite.fill(65280)}drawHitbox(){this.hitboxSprite.clear(),this.hitboxSprite.circle(0,0,this.config.hitboxRadius).fill({color:16711680,alpha:.5})}setupHpBar(){this.hpBarContainer.x=s.PLAYER.HP_BAR.OFFSET_X,this.hpBarContainer.y=s.PLAYER.HP_BAR.OFFSET_Y,this.hpBarBg.rect(0,0,s.PLAYER.HP_BAR.WIDTH,s.PLAYER.HP_BAR.HEIGHT).fill(3355443),this.hpBarContainer.addChild(this.hpBarBg),this.drawHpBar(),this.hpBarContainer.addChild(this.hpBarFill),this.sprite.addChild(this.hpBarContainer)}drawHpBar(){this.hpBarFill.clear();const t=this.currentHp/this.maxHp,e=s.PLAYER.HP_BAR.WIDTH*t;let i=s.PLAYER.HP_BAR.COLORS.HIGH;t<=.5&&(i=s.PLAYER.HP_BAR.COLORS.MEDIUM),t<=.25&&(i=s.PLAYER.HP_BAR.COLORS.LOW),this.hpBarFill.rect(0,0,e,s.PLAYER.HP_BAR.HEIGHT).fill(i)}update(t,e){const i=t/e;this.gameTime+=i,this.invulnerable&&(this.invulnerableTime-=i,this.invulnerableTime<=0?(this.invulnerable=!1,this.sprite.alpha=1):this.sprite.alpha=Math.sin(this.invulnerableTime*s.PLAYER.INVULNERABILITY_BLINK_RATE)>0?1:.5)}move(t,e,i,n){const o=this.slowMode?this.config.slowSpeed:this.config.speed,r=i/n;this.sprite.x+=t*o*r,this.sprite.y+=e*o*r}clampPosition(t,e,i,n){this.sprite.x=Math.max(t+s.PLAYER.MOVEMENT_MARGIN,Math.min(i-s.PLAYER.MOVEMENT_MARGIN,this.sprite.x)),this.sprite.y=Math.max(e+s.PLAYER.MOVEMENT_MARGIN,Math.min(n-s.PLAYER.MOVEMENT_MARGIN,this.sprite.y))}setSlowMode(t){this.slowMode=t,this.hitboxSprite.visible=t}canShoot(){return this.gameTime-this.lastFireTime>=this.config.fireRate}shoot(){if(!this.canShoot())return[];this.lastFireTime=this.gameTime;const t=[],e=new R({x:this.sprite.x,y:this.sprite.y+s.PLAYER.BULLET.OFFSET_Y,vx:s.PLAYER.BULLET.VELOCITY_X,vy:s.PLAYER.BULLET.VELOCITY_Y,damage:s.PLAYER.BULLET.DAMAGE,isPlayerBullet:!0,color:s.PLAYER.BULLET.COLOR,radius:s.PLAYER.BULLET.RADIUS});return t.push(e),t}tryAutoShoot(){return this.shoot()}takeDamage(t=1){if(!this.invulnerable){if(this.currentHp-=t,this.drawHpBar(),this.currentHp<=0)if(this.currentHp=0,this.lives--,this.lives>0)this.currentHp=this.maxHp,this.drawHpBar();else{console.log("Game Over");return}this.invulnerable=!0,this.invulnerableTime=s.PLAYER.INVULNERABILITY_DURATION}}reset(){this.sprite.x=this.config.x,this.sprite.y=this.config.y,this.lives=s.PLAYER.DEFAULT_LIVES,this.currentHp=this.maxHp,this.drawHpBar(),this.invulnerable=!1,this.invulnerableTime=0,this.sprite.alpha=1,this.slowMode=!1,this.hitboxSprite.visible=!1,this.gameTime=0,this.lastFireTime=0}getSprite(){return this.sprite}getX(){return this.sprite.x}getY(){return this.sprite.y}getHitboxRadius(){return this.config.hitboxRadius}isInvulnerable(){return this.invulnerable}getCurrentHp(){return this.currentHp}getMaxHp(){return this.maxHp}getLives(){return this.lives}}class G{constructor(t){a(this,"currentStage",1);a(this,"maxStages");a(this,"isStageActive",!0);a(this,"isBossPhase",!1);this.maxStages=t}getCurrentStage(){return this.currentStage}isActive(){return this.isStageActive}isBossActive(){return this.isBossPhase}startBossPhase(){this.isBossPhase=!0}completeBossPhase(){this.isBossPhase=!1,this.nextStage()}nextStage(){this.currentStage<this.maxStages?this.currentStage++:this.isStageActive=!1}reset(){this.currentStage=1,this.isStageActive=!0,this.isBossPhase=!1}}class x{constructor(t,e,i){a(this,"sprite");a(this,"healthBar");a(this,"config");a(this,"hp");a(this,"maxHp");a(this,"time",0);a(this,"lastFireTime",0);a(this,"startX");a(this,"startY");a(this,"baseY");a(this,"shouldFireNow",!1);this.config=t,this.hp=t.hp,this.maxHp=t.hp,this.startX=e,this.startY=i,this.baseY=i,this.createSprite(),this.createHealthBar(),this.sprite.x=e,this.sprite.y=i}createSprite(){const e=(this.config.imageType||g.TYPE1)===g.TYPE1?s.ENEMY.IMAGES.TYPE1.PATH:s.ENEMY.IMAGES.TYPE2.PATH,i=C.from(e);this.sprite=new _(i),this.sprite.anchor.set(.5,.5);const n=this.getDimensionsByType();this.sprite.width=n.width,this.sprite.height=n.height}createHealthBar(){this.healthBar=new A,this.sprite.addChild(this.healthBar),this.updateHealthBar()}updateHealthBar(){if(this.healthBar.clear(),this.hp<this.maxHp){const t=this.getDimensionsByType(),e=Math.max(t.width,t.height)/2+s.ENEMY.HEALTH_BAR.RADIUS_OFFSET;this.healthBar.lineStyle(s.ENEMY.HEALTH_BAR.STROKE_WIDTH,s.ENEMY.HEALTH_BAR.COLOR),this.healthBar.arc(0,0,e,-Math.PI/2,-Math.PI/2+Math.PI*2*this.hp/this.maxHp)}}getDimensionsByType(){const e=(this.config.imageType||g.TYPE1)===g.TYPE1?s.ENEMY.TYPES:s.ENEMY.TYPE2_SIZES;switch(this.config.type){case"small":return{width:e.SMALL.WIDTH,height:e.SMALL.HEIGHT};case"medium":return{width:e.MEDIUM.WIDTH,height:e.MEDIUM.HEIGHT};case"large":return{width:e.LARGE.WIDTH,height:e.LARGE.HEIGHT};default:return{width:e.SMALL.WIDTH,height:e.SMALL.HEIGHT}}}update(t,e){const i=t/e;this.time+=i,this.updateMovement(i),this.shouldFireNow=this.updateFiring()}updateMovement(t){const e=this.config.movement,i=this.time*s.ENEMY.MOVEMENT.TIME_MULTIPLIER;switch(e.type){case"linear":this.sprite.y+=e.speed*t;break;case"sine":this.sprite.x=this.startX+Math.sin(i*(e.frequency||1))*(e.amplitude||s.ENEMY.MOVEMENT.DEFAULT_AMPLITUDE),this.sprite.y+=e.speed*t;break;case"circular":const n=i*(e.frequency||1);this.baseY+=e.speed*t,this.sprite.x=this.startX+Math.cos(n)*(e.amplitude||s.ENEMY.MOVEMENT.DEFAULT_AMPLITUDE),this.sprite.y=this.baseY+Math.sin(n)*(e.amplitude||s.ENEMY.MOVEMENT.DEFAULT_AMPLITUDE);break;case"custom":if(e.customFunction){const o=e.customFunction(i);this.sprite.x=this.startX+o.x,this.sprite.y=this.startY+o.y}break}}updateFiring(){if(!this.config.firePattern)return!1;const t=this.config.firePattern;return this.time-this.lastFireTime>=t.interval?(this.lastFireTime=this.time,!0):!1}shouldFire(){return this.shouldFireNow}createBullets(t){const e=[];switch(t.type){case"single":e.push(new R({x:this.sprite.x,y:this.sprite.y,vx:0,vy:t.bulletSpeed,damage:s.ENEMY.FIRING.BULLET_DAMAGE,isPlayerBullet:!1}));break;case"spread":const i=t.bulletCount||s.ENEMY.FIRING.SPREAD_COUNT,n=t.spreadAngle||s.ENEMY.FIRING.SPREAD_ANGLE;for(let r=0;r<i;r++){const l=n*(r-(i-1)/2)*Math.PI/180;e.push(new R({x:this.sprite.x,y:this.sprite.y,vx:Math.sin(l)*t.bulletSpeed,vy:Math.cos(l)*t.bulletSpeed,damage:s.ENEMY.FIRING.BULLET_DAMAGE,isPlayerBullet:!1}))}break;case"circular":const o=t.bulletCount||s.ENEMY.FIRING.CIRCULAR_COUNT;for(let r=0;r<o;r++){const l=360/o*r*Math.PI/180;e.push(new R({x:this.sprite.x,y:this.sprite.y,vx:Math.cos(l)*t.bulletSpeed,vy:Math.sin(l)*t.bulletSpeed,damage:s.ENEMY.FIRING.BULLET_DAMAGE,isPlayerBullet:!1}))}break}return e}takeDamage(t){this.hp-=t,this.updateHealthBar()}isAlive(){return this.hp>0}isOutOfBounds(t,e){const i=s.ENEMY.BOUNDS_MARGIN;return this.sprite.x<-i||this.sprite.x>t+i||this.sprite.y>e+i}getSprite(){return this.sprite}getX(){return this.sprite.x}getY(){return this.sprite.y}getRadius(){const t=this.getDimensionsByType();return Math.max(t.width,t.height)/2}getScore(){return this.config.score}getFirePattern(){return this.config.firePattern}}class k{constructor(t,e){a(this,"spawnTimer",0);a(this,"spawnInterval",s.SPAWNING.DEFAULT_INTERVAL);a(this,"gameWidth");this.gameWidth=t}update(t,e,i){const n=t/i;this.spawnTimer+=n;const o=[];if(this.spawnTimer>=this.spawnInterval){this.spawnTimer=0;const r=Math.min(e,s.SPAWNING.MAX_COUNT_PER_WAVE);for(let l=0;l<r;l++)o.push(this.createEnemy(e));this.spawnInterval=Math.max(s.SPAWNING.MIN_INTERVAL,s.SPAWNING.DEFAULT_INTERVAL-e*s.SPAWNING.INTERVAL_REDUCTION_PER_STAGE)}return o}createEnemy(t){const e=Math.random()*(this.gameWidth-s.SPAWNING.SPAWN_MARGIN*2)+s.SPAWNING.SPAWN_MARGIN,i=s.SPAWNING.SPAWN_Y_OFFSET,o=[p.SMALL,p.MEDIUM,p.LARGE][Math.min(Math.floor(Math.random()*t),2)],r=Math.random()<.3+t*.1?g.TYPE2:g.TYPE1;let l,c;if(r===g.TYPE1)switch(o){case p.SMALL:l=s.ENEMY.TYPES.SMALL.HP,c=s.ENEMY.TYPES.SMALL.SCORE;break;case p.MEDIUM:l=s.ENEMY.TYPES.MEDIUM.HP,c=s.ENEMY.TYPES.MEDIUM.SCORE;break;case p.LARGE:l=s.ENEMY.TYPES.LARGE.HP,c=s.ENEMY.TYPES.LARGE.SCORE;break}else switch(o){case p.SMALL:l=s.ENEMY.TYPE2_SIZES.SMALL.HP,c=s.ENEMY.TYPE2_SIZES.SMALL.SCORE;break;case p.MEDIUM:l=s.ENEMY.TYPE2_SIZES.MEDIUM.HP,c=s.ENEMY.TYPE2_SIZES.MEDIUM.SCORE;break;case p.LARGE:l=s.ENEMY.TYPE2_SIZES.LARGE.HP,c=s.ENEMY.TYPE2_SIZES.LARGE.SCORE;break}const d=r===g.TYPE2?Math.random()>.3?"circular":"sine":Math.random()>.5?"sine":"linear";let u;return r===g.TYPE2?u={type:Math.random()>.5?"spread":"circular",interval:s.ENEMY.FIRING.INTERVAL*1.2,bulletSpeed:s.ENEMY.FIRING.BULLET_SPEED*.8,bulletCount:o===p.LARGE?5:3,spreadAngle:45}:u={type:"single",interval:s.ENEMY.FIRING.INTERVAL,bulletSpeed:s.ENEMY.FIRING.BULLET_SPEED},new x({type:o,imageType:r,hp:l,score:c,movement:{type:d,speed:s.ENEMY.MOVEMENT.SPEED_MIN+Math.random()*s.ENEMY.MOVEMENT.SPEED_RANDOM,amplitude:d!=="linear"?s.ENEMY.MOVEMENT.SINE_AMPLITUDE_MIN+Math.random()*s.ENEMY.MOVEMENT.SINE_AMPLITUDE_RANDOM:void 0,frequency:d!=="linear"?s.ENEMY.MOVEMENT.SINE_FREQUENCY_MIN+Math.random()*s.ENEMY.MOVEMENT.SINE_FREQUENCY_RANDOM:void 0},firePattern:u},e,i)}reset(){this.spawnTimer=0,this.spawnInterval=s.SPAWNING.DEFAULT_INTERVAL}}class F{constructor(t,e,i,n,o,r){a(this,"player");a(this,"getEnemies");a(this,"getEnemyBullets");a(this,"getPlayerBullets");this.player=t,this.getEnemies=e,this.getEnemyBullets=i,this.getPlayerBullets=n}check(){const t={playerHit:!1,destroyedEnemies:[],hitBullets:[],hitPlayerBullets:[]},e=this.getEnemies(),i=this.getEnemyBullets(),n=this.getPlayerBullets();if(!this.player.isInvulnerable())for(const o of i)this.checkCircleCollision(this.player.getX(),this.player.getY(),this.player.getHitboxRadius(),o.getX(),o.getY(),o.getRadius())&&(t.playerHit=!0,t.hitBullets.push(o));for(const o of n)for(const r of e)if(r.isAlive()&&this.checkCircleCollision(o.getX(),o.getY(),o.getRadius(),r.getX(),r.getY(),r.getRadius())){r.takeDamage(o.getDamage()),t.hitPlayerBullets.push(o),r.isAlive()||t.destroyedEnemies.push(r);break}return t}checkCircleCollision(t,e,i,n,o,r){const l=n-t,c=o-e;return Math.sqrt(l*l+c*c)<i+r}}class V{constructor(){a(this,"score",0);a(this,"highScore",0);a(this,"combo",0);a(this,"maxCombo",0);const t=localStorage.getItem("shootingHighScore");t&&(this.highScore=parseInt(t,10))}addScore(t){this.score+=t*(1+this.combo*s.SCORE.COMBO_MULTIPLIER),this.combo++,this.maxCombo=Math.max(this.maxCombo,this.combo),this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("shootingHighScore",this.highScore.toString()))}resetCombo(){this.combo=0}getScore(){return Math.floor(this.score)}getHighScore(){return Math.floor(this.highScore)}getCombo(){return this.combo}reset(){this.score=0,this.combo=0,this.maxCombo=0}}class W{constructor(){a(this,"grazeRadius",s.GRAZE.RADIUS);a(this,"grazedBullets",new Set)}checkGraze(t,e){let i=0;const n=[];for(const r of e)if(!r.getIsPlayerBullet()&&!this.grazedBullets.has(r)){const l=this.getDistance(t.getX(),t.getY(),r.getX(),r.getY());l<this.grazeRadius&&l>t.getHitboxRadius()+r.getRadius()&&(this.grazedBullets.add(r),i++,n.push({bullet:r,x:r.getX(),y:r.getY()}))}const o=new Set(e);for(const r of this.grazedBullets)o.has(r)||this.grazedBullets.delete(r);return{count:i,events:n}}createGrazeEffect(t,e,i){const n=s.GRAZE.PARTICLE.COUNT;for(let o=0;o<n;o++){const r=new A;r.circle(0,0,s.GRAZE.PARTICLE.RADIUS).fill(s.GRAZE.PARTICLE.COLOR);const l=o/n*Math.PI*2,c=s.GRAZE.PARTICLE.SPEED_MIN+Math.random()*(s.GRAZE.PARTICLE.SPEED_MAX-s.GRAZE.PARTICLE.SPEED_MIN),d=Math.cos(l)*c,u=Math.sin(l)*c;r.x=e,r.y=i,t.addChild(r);let E=s.GRAZE.PARTICLE.LIFETIME;const m=()=>{if(E-=1/s.GRAZE.PARTICLE.TARGET_FPS,E<=0){t.removeChild(r);return}r.x+=d*(1/s.GRAZE.PARTICLE.TARGET_FPS),r.y+=u*(1/s.GRAZE.PARTICLE.TARGET_FPS),r.alpha=E/s.GRAZE.PARTICLE.LIFETIME,requestAnimationFrame(m)};requestAnimationFrame(m)}}getDistance(t,e,i,n){const o=i-t,r=n-e;return Math.sqrt(o*o+r*r)}reset(){this.grazedBullets.clear()}}class X extends N{constructor(e){super(e);a(this,"gameContainer");a(this,"inputHandler");a(this,"backgroundSprite1");a(this,"backgroundSprite2");a(this,"backgroundLoaded",!1);a(this,"player");a(this,"enemies",[]);a(this,"boss",null);a(this,"bullets",[]);a(this,"playerBullets",[]);a(this,"stageSystem");a(this,"enemySpawner");a(this,"collisionSystem");a(this,"scoreSystem");a(this,"grazeSystem");a(this,"gameAreaWidth");a(this,"gameAreaHeight");a(this,"lastScoreThreshold",0);this.gameAreaWidth=e.gameAreaWidth||s.GAME.AREA_WIDTH,this.gameAreaHeight=e.gameAreaHeight||s.GAME.AREA_HEIGHT}async setupGameSpecific(){await this.loadBackgroundAssets(),this.setupGameArea(),await this.loadEnemyAssets(),this.initPlayer(),this.initSystems(),this.setupInputHandler(),console.log("ShootingGameController: Game setup complete"),this.app.ticker.add(e=>this.update(e.deltaTime),this)}async loadBackgroundAssets(){try{await P.load(s.BACKGROUND.IMAGE_PATH),this.backgroundLoaded=!0,console.log("Background texture loaded successfully")}catch(e){console.error("Failed to load background texture:",e),this.backgroundLoaded=!1}}setupGameArea(){this.gameContainer=new y,this.app.stage.addChild(this.gameContainer);const e=C.from(s.BACKGROUND.IMAGE_PATH);this.backgroundSprite1=new _(e),this.backgroundSprite1.width=this.gameAreaWidth,this.backgroundSprite1.height=this.gameAreaHeight,this.backgroundSprite1.x=0,this.backgroundSprite1.y=0,this.gameContainer.addChild(this.backgroundSprite1),this.backgroundSprite2=new _(e),this.backgroundSprite2.width=this.gameAreaWidth,this.backgroundSprite2.height=this.gameAreaHeight,this.backgroundSprite2.x=0,this.backgroundSprite2.y=-this.gameAreaHeight,this.gameContainer.addChild(this.backgroundSprite2);const i=new A;i.rect(0,0,this.gameAreaWidth,this.gameAreaHeight).fill(16777215),this.gameContainer.mask=i,this.gameContainer.addChild(i)}async loadEnemyAssets(){try{await P.load(s.ENEMY.IMAGES.TYPE1.PATH),await P.load(s.ENEMY.IMAGES.TYPE2.PATH),console.log("Enemy textures loaded successfully")}catch(e){console.error("Failed to load enemy textures:",e)}}initPlayer(){this.player=new U({x:this.gameAreaWidth/2,y:this.gameAreaHeight-s.PLAYER.DEFAULT_Y_OFFSET,speed:s.PLAYER.SPEED,slowSpeed:s.PLAYER.SLOW_SPEED,hitboxRadius:s.PLAYER.HITBOX_RADIUS,fireRate:s.PLAYER.FIRE_RATE,maxHp:s.PLAYER.MAX_HP}),this.gameContainer.addChild(this.player.getSprite())}initSystems(){this.scoreSystem=new V;const e=this.options;this.stageSystem=new G(e.stageCount||s.STAGE.DEFAULT_MAX_STAGES),this.enemySpawner=new k(this.gameAreaWidth,this.gameAreaHeight),this.collisionSystem=new F(this.player,()=>this.enemies,()=>this.bullets,()=>this.playerBullets,this.gameAreaWidth,this.gameAreaHeight),this.grazeSystem=new W}setupInputHandler(){const e=this.options;this.inputHandler=new Y(this,e.inputOptions)}update(e){this.updateScroll(e),this.updateEntities(e),this.inputHandler.updateMovement(e),this.spawnEnemies(e),this.checkCollisions(),this.checkScoreThreshold(),this.cleanupEntities()}updateScroll(e){const i=s.BACKGROUND.SCROLL_SPEED*e;this.backgroundSprite1.y+=i,this.backgroundSprite2.y+=i,this.backgroundSprite1.y>=this.gameAreaHeight&&(this.backgroundSprite1.y=this.backgroundSprite2.y-this.gameAreaHeight),this.backgroundSprite2.y>=this.gameAreaHeight&&(this.backgroundSprite2.y=this.backgroundSprite1.y-this.gameAreaHeight)}updateEntities(e){this.player.update(e,S.targetFPMS),this.inputHandler.isAutoFireEnabled()&&this.player.tryAutoShoot().forEach(n=>{this.playerBullets.push(n),this.gameContainer.addChild(n.getSprite())}),this.enemies.forEach(i=>{i.update(e,S.targetFPMS),i.shouldFire()&&i.getFirePattern()&&i.createBullets(i.getFirePattern()).forEach(o=>{this.bullets.push(o),this.gameContainer.addChild(o.getSprite())})}),this.boss&&this.boss.update(e),this.bullets.forEach(i=>i.update(e,S.targetFPMS)),this.playerBullets.forEach(i=>i.update(e,S.targetFPMS))}spawnEnemies(e){!this.boss&&this.stageSystem.isActive()&&this.enemySpawner.update(e,this.stageSystem.getCurrentStage(),S.targetFPMS).forEach(n=>{this.enemies.push(n),this.gameContainer.addChild(n.getSprite())})}checkCollisions(){const e=this.collisionSystem.check();e.playerHit&&this.player.takeDamage(),e.destroyedEnemies.forEach(n=>{this.scoreSystem.addScore(n.getScore()),this.triggerBlockReveal(n.getX(),n.getY(),M.SMALL)}),e.hitBullets.forEach(n=>{this.gameContainer.removeChild(n.getSprite())}),this.bullets=this.bullets.filter(n=>!e.hitBullets.includes(n)),e.hitPlayerBullets.forEach(n=>{this.gameContainer.removeChild(n.getSprite())}),this.playerBullets=this.playerBullets.filter(n=>!e.hitPlayerBullets.includes(n));const i=this.grazeSystem.checkGraze(this.player,this.bullets);i.count>0&&(this.scoreSystem.addScore(i.count*s.GRAZE.SCORE_PER_BULLET),this.triggerBlockReveal(this.player.getX(),this.player.getY(),M.SMALL),i.events.forEach(n=>{this.grazeSystem.createGrazeEffect(this.gameContainer,n.x,n.y)}))}checkScoreThreshold(){const e=this.scoreSystem.getScore(),i=Math.floor(e/s.SCORE.BLOCK_REVEAL_THRESHOLD)*s.SCORE.BLOCK_REVEAL_THRESHOLD;i>this.lastScoreThreshold&&i>0&&(this.lastScoreThreshold=i,this.triggerBlockReveal(this.gameAreaWidth/2,this.gameAreaHeight/2,M.MEDIUM))}cleanupEntities(){this.enemies=this.enemies.filter(e=>!e.isAlive()||e.isOutOfBounds(this.gameAreaWidth,this.gameAreaHeight)?(this.gameContainer.removeChild(e.getSprite()),!1):!0),this.bullets=this.bullets.filter(e=>e.isOutOfBounds(this.gameAreaWidth,this.gameAreaHeight)?(this.gameContainer.removeChild(e.getSprite()),!1):!0),this.playerBullets=this.playerBullets.filter(e=>e.isOutOfBounds(this.gameAreaWidth,this.gameAreaHeight)?(this.gameContainer.removeChild(e.getSprite()),!1):!0)}triggerBlockReveal(e,i,n){const o=Math.random(),r=Math.random();this.blockReveal.reveal({x:o,y:r,radius:n,force:n*s.BLOCK_REVEAL.FORCE_MULTIPLIER,duration:s.BLOCK_REVEAL.DURATION})}movePlayer(e,i,n){this.player.move(e,i,n,S.targetFPMS),this.player.clampPosition(0,0,this.gameAreaWidth,this.gameAreaHeight)}setPlayerSlowMode(e){this.player.setSlowMode(e)}playerShoot(){this.player.shoot().forEach(i=>{this.playerBullets.push(i),this.gameContainer.addChild(i.getSprite())})}getGameContainer(){return this.gameContainer}getCanvas(){return this.app.canvas}movePlayerToPosition(e,i,n){const o=e*this.gameAreaWidth,r=i*this.gameAreaHeight,l=this.player.getX(),c=this.player.getY(),d=o-l,u=r-c,E=Math.sqrt(d*d+u*u);if(E>1){const m=Math.min(E*.1,1),I=d/E*m,L=u/E*m;this.player.move(I,L,n,S.targetFPMS),this.player.clampPosition(0,0,this.gameAreaWidth,this.gameAreaHeight)}}onImagesLoaded(){console.log("Shooting game images loaded"),this.inputHandler&&this.inputHandler.enable(),console.log("ShootingGameController: Images loaded, resize will be handled by setup completion")}setupAdditionalEventListeners(){}handleGameSpecificKeyDown(e){this.inputHandler.handleKeyDown(e)}onReset(){this.enemies.forEach(e=>this.gameContainer.removeChild(e.getSprite())),this.bullets.forEach(e=>this.gameContainer.removeChild(e.getSprite())),this.playerBullets.forEach(e=>this.gameContainer.removeChild(e.getSprite())),this.enemies=[],this.bullets=[],this.playerBullets=[],this.boss=null,this.player.reset(),this.scoreSystem.reset(),this.stageSystem.reset(),this.lastScoreThreshold=0}destroyGameSpecific(){this.app.ticker.remove(e=>this.update(e.deltaTime),this),this.inputHandler.destroy()}resize(){if(super.resize(),!this.gameContainer){console.warn("ShootingGameController: resize() called but gameContainer not initialized yet");return}if(!this.backgroundLoaded){console.warn("ShootingGameController: resize() called but background resources not loaded yet");return}console.log("ShootingGameController: Performing resize");const e=this.containerElement,i=e.clientWidth,n=e.clientHeight,o=s.GAME.AREA_RATIO,r=i*o,l=n,c=r/this.gameAreaWidth,d=l/this.gameAreaHeight,u=Math.min(c,d);this.gameContainer.scale.set(u);const E=this.gameAreaWidth*u,m=this.gameAreaHeight*u;this.gameContainer.x=(i-E)/2,this.gameContainer.y=(n-m)/2}}class f{static isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||window.matchMedia&&window.matchMedia("(pointer: coarse)").matches}static isMobile(){const t=navigator.userAgent.toLowerCase(),i=["android","webos","iphone","ipad","ipod","blackberry","windows phone","mobile"].some(o=>t.includes(o)),n=window.innerWidth<=768;return this.isTouchDevice()&&(i||n)}static isTablet(){const t=navigator.userAgent.toLowerCase(),e=t.includes("ipad"),i=t.includes("android")&&!t.includes("mobile"),n=window.innerWidth>768&&window.innerWidth<=1024;return this.isTouchDevice()&&(e||i||n)}static getOrientation(){return window.screen&&window.screen.orientation?window.screen.orientation.type.includes("landscape")?"landscape":"portrait":window.innerWidth>window.innerHeight?"landscape":"portrait"}static getDeviceType(){return this.isMobile()?"mobile":this.isTablet()?"tablet":"desktop"}}let T;async function K(){const h=f.isMobile(),t=f.isTablet(),e=f.isTouchDevice(),i={enableKeyboard:!0,enableMouse:!1,enableTouch:e,enableGamepad:!0,autoFire:h||t,mouseControlType:"relative",touchControlType:"virtual-stick"};T=new X({containerId:"shooting-game-area",blockRevealContainerId:"block-reveal-area",backgroundImage:"./assets/images/background.png",foregroundImage:"./assets/images/foreground.png",blockSize:8,gravity:1e3,explosionForce:300,fadeOutDuration:500,stageCount:3,playerLives:3,continueCount:3,inputOptions:i});const n=()=>{var d,u,E;const r=((d=T.scoreSystem)==null?void 0:d.getScore())||0,l=((u=T.scoreSystem)==null?void 0:u.getHighScore())||0,c=((E=T.stageSystem)==null?void 0:E.getCurrentStage())||1;document.getElementById("score").textContent=r.toString(),document.getElementById("high-score").textContent=l.toString(),document.getElementById("stage").textContent=c.toString(),requestAnimationFrame(n)};n();const o=document.querySelector(".controls .info");o&&(h||t?o.textContent="Touch & Drag: Move | Auto Fire Enabled":e&&(o.textContent="Touch/Mouse: Move | Click: Shoot | Keys: WASD/Arrows"))}document.getElementById("reset-button").addEventListener("click",()=>{T&&T.reset()});window.addEventListener("load",K);
